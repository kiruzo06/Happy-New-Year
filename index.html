<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Happy New Year!!</title>

    <style>
        /* --- CSS STYLING --- */
        :root {
            --primary-color: #ff4757;
            --glass-bg: rgba(255, 255, 255, 0.1);
            --card-bg: #ffffff;
            --text-main: #2f3542;
            --text-muted: #57606f;
            --transition: all 0.6s cubic-bezier(0.23, 1, 0.32, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background: radial-gradient(circle at center, #0a0a1a 0%, #020205 100%);
            color: white;
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            overflow: hidden;
            height: 100vh;
            width: 100vw;
        }

        #fireworksCanvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        /* UI Elements */
        #ui-layer {
            position: fixed;
            top: 5vh;
            width: 100%;
            text-align: center;
            z-index: 10;
            pointer-events: none;
        }

        #counter-display {
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--primary-color);
            text-shadow: 0 0 20px rgba(255, 71, 87, 0.6);
        }

        #sound-toggle {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--glass-bg);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            padding: 12px 20px;
            border-radius: 30px;
            cursor: pointer;
            z-index: 1000;
            backdrop-filter: blur(8px);
            min-width: 120px;
        }

        /* --- SURPRISE CONTAINER --- */
        #surprise-wrapper {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 100;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.8s ease;
        }

        #surprise-wrapper.visible {
            opacity: 1;
            pointer-events: auto;
        }

        .content-container {
            position: relative;
            width: 90%;
            max-width: 500px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .card {
            background: var(--card-bg);
            color: var(--text-main);
            width: 100%;
            min-height: 400px;
            border-radius: 30px;
            padding: 40px;
            position: relative;
            z-index: 2;
            box-shadow: 0 30px 60px rgba(0, 0, 0, 0.5);
            display: flex;
            flex-direction: column;
            transform: scale(0.8) translateY(50px);
            transition: var(--transition);
        }

        #surprise-wrapper.visible .card {
            transform: scale(1) translateY(0);
        }

        .card-header h1 { 
            font-size: 1.8rem; 
            color: var(--primary-color); 
            text-align: center; 
            margin-bottom: 20px;
        }

        .message-body {
            overflow-y: auto;
            flex-grow: 1;
            line-height: 1.7;
            font-size: 1.05rem;
            color: var(--text-muted);
            white-space: pre-wrap;
            margin-bottom: 20px;
            text-align: center;
        }

        .card-footer {
            margin-top: auto;
            text-align: center;
            border-top: 1px solid #eee;
            padding-top: 15px;
        }

        #restart-btn {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 50px;
            cursor: pointer;
            font-weight: bold;
        }
    </style>
</head>
<body>

    <canvas id="fireworksCanvas"></canvas>

    <div id="ui-layer">
        <p>Tap to launch fireworks</p>
        <div id="counter-display"><span id="count">0</span> / 10</div>
    </div>

    <button id="sound-toggle">ðŸ”Š Sound On</button>

    <div id="surprise-wrapper">
        <div class="content-container">
            <div class="card">
                <div class="card-header"><h1 id="card-title"></h1></div>
                <div class="message-body" id="card-message"></div>
                <div class="card-footer">
                    <p id="card-sender" style="margin-bottom: 15px; font-weight: bold;"></p>
                    <button id="restart-btn">Restart Game</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- YOUR CUSTOMIZATION AREA ---
        
        const soundFiles = {
            launch: "./sound/launch.mp3", 
            explosion: "./sound/explosion.mp3",
            finalSurprise: "https://assets.mixkit.co/active_storage/sfx/1435/1435-preview.mp3"
        };

        const letterData = {
            title: "Happy New Year!",
            message: `Another Year po na we both have each other,alam ko po there are times na nasasaktan kita nafifeel mo na di kita mahal, pero I love you po always, lagi lang po ako nandito sabihan mo lang po ako if may nagbbother sayo, samahan kita palagi. \n \n Thank you po kasi palagi ka po nandiyan para sakin, dahil po sayo lagi masaya at buo ang araw ko, sana sa susunod na mga taon ay magkausap or magkasama pa rin tayo, nandito lang po ako palagi mahal na mahal po kita `,
            sender: "â€” Paul na mahal na mahal ka, ay"
        };

        // --- AUDIO ENGINE ---
        let isMuted = false;

        function playSound(key) {
            if (isMuted || !soundFiles[key]) return;
            const audio = new Audio(soundFiles[key]);
            audio.volume = 0.5;
            audio.play().catch(e => console.log("Audio play blocked"));
        }

        const soundBtn = document.getElementById('sound-toggle');
        soundBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            isMuted = !isMuted;
            soundBtn.innerText = isMuted ? "ðŸ”‡ Sound Off" : "ðŸ”Š Sound On";
        });

        // --- Optimized Fireworks Engine ---
        const canvas = document.getElementById('fireworksCanvas');
        const ctx = canvas.getContext('2d');
        let particles = [];
        let rockets = [];
        let clickCount = 0;
        let isGameOver = false;

        function resize() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
        window.addEventListener('resize', resize);
        resize();

        class Particle {
            constructor(x, y, color) {
                this.x = x; this.y = y; this.color = color;
                this.alpha = 1;
                this.friction = 0.88; // Higher friction slows them down faster
                this.gravity = 0.25;  // Slightly more gravity for faster arc
                this.life = Math.random() * 5 + 5; // Reduced life (shorter delay before fade)
                this.decay = Math.random() * 0.08 + 0.08; // Much faster fade (v2 was 0.04)
                
                const angle = Math.random() * Math.PI * 2;
                const speed = Math.random() * 10 + 2;
                this.vx = Math.cos(angle) * speed;
                this.vy = Math.sin(angle) * speed;
            }
            update() {
                this.vx *= this.friction; 
                this.vy *= this.friction;
                this.vy += this.gravity; 
                this.x += this.vx; 
                this.y += this.vy;
                
                if (this.life > 0) {
                    this.life--;
                } else {
                    this.alpha -= this.decay;
                }
            }
            draw() {
                if (this.alpha <= 0) return;
                ctx.globalAlpha = this.alpha;
                ctx.beginPath();
                ctx.arc(this.x, this.y, 1.8, 0, Math.PI * 2);
                ctx.fillStyle = this.color;
                ctx.fill();
            }
        }

        class Rocket {
            constructor(tx, ty) {
                this.x = Math.random() * canvas.width;
                this.y = canvas.height;
                this.tx = tx; this.ty = ty;
                this.vx = (tx - this.x) / 18; // Speed up the travel to the point
                this.vy = (ty - this.y) / 18;
                this.alive = true;
                playSound('launch');
            }
            update() {
                this.x += this.vx; this.y += this.vy;
                if (Math.abs(this.y - this.ty) < 10) {
                    this.alive = false;
                    createExplosion(this.tx, this.ty);
                }
            }
            draw() {
                ctx.fillStyle = "white";
                ctx.beginPath(); ctx.arc(this.x, this.y, 2, 0, Math.PI * 2); ctx.fill();
            }
        }

        function createExplosion(x, y, isFinal = false) {
            playSound('explosion');
            const hue = Math.floor(Math.random() * 360);
            const color = `hsla(${hue}, 100%, 60%, 1)`;
            // Reduced particle count for smoother performance
            const count = isFinal ? 80 : 35; 
            for (let i = 0; i < count; i++) particles.push(new Particle(x, y, color));
        }

        function animate() {
            // Using a darker clear rect for cleaner trails
            ctx.fillStyle = 'rgba(2, 2, 5, 0.4)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            rockets.forEach((r, i) => { 
                r.update(); 
                r.draw(); 
                if (!r.alive) rockets.splice(i, 1); 
            });
            
            particles.forEach((p, i) => { 
                p.update(); 
                p.draw(); 
                if (p.alpha <= 0) particles.splice(i, 1); 
            });
            
            requestAnimationFrame(animate);
        }
        animate();

        const handleInteraction = (e) => {
            if (isGameOver) return;
            const x = e.clientX || (e.touches && e.touches[0].clientX);
            const y = e.clientY || (e.touches && e.touches[0].clientY);
            if (!x || !y) return;
            
            clickCount++;
            document.getElementById('count').innerText = clickCount;
            
            if (clickCount >= 10) {
                isGameOver = true;
                setTimeout(() => {
                    createExplosion(canvas.width / 2, canvas.height / 3, true);
                    playSound('finalSurprise');
                }, 300);
                setTimeout(showSurprise, 1000);
            } else {
                rockets.push(new Rocket(x, y));
            }
        };

        window.addEventListener('mousedown', handleInteraction);
        window.addEventListener('touchstart', (e) => { handleInteraction(e); e.preventDefault(); }, { passive: false });

        function showSurprise() {
            document.getElementById('card-title').innerText = letterData.title;
            document.getElementById('card-message').innerText = letterData.message;
            document.getElementById('card-sender').innerText = letterData.sender;
            document.getElementById('surprise-wrapper').classList.add('visible');
        }

        document.getElementById('restart-btn').addEventListener('click', () => {
            location.reload();
        });
    </script>
</body>
</html>
